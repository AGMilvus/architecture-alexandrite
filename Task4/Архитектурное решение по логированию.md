# Требуется залогировать
Системы:
Shop API, CRM API, MES API, RabbitMQ, S3-хранилище, Shop DB, MES DB

- INFO  - все операции работы с заказом и изменения статуса заказа. В логе должно быть минимум 2 записи: запрос на операцию получен, запрос на операцию завершен успешно (или ошибка). Логируем:
    - время,
    - идентификатор покупателя,
    - номер заказа,
    - номер инстанса,
    - id трассировки.
- ERROR - ошибки валидации, таймауты, дедлоки транзакций.
- WARN - ошибки авторизации.
- FATAL - падение сервиса.
- DEBUG - максимально полный лог для целей разработки и тестирования.

# Мотивация
Уже сейчас компания сталкивается с ухудшением клиентского и пользовательского опыта, вызванного ростом нагрузки, снижением отзавчивости и задержками в исполнении заказов. Отсутсвие Логирования не позволяет оперативно выявлять, локализовывать и утранять проблемы. Ситуация имеет тенденцию к усугублению. Как итог компания теряет клиентов и деньги.
Логирование играет важную роль в обеспечении стабильности и эффективности работы компании. Правильное использование логирования помогает на разных этапах работы системы и позволяет улучшить как технические процессы, так и бизнес-операции.
- Логирование помогает отслеживать ошибки, исключения и сбои в приложении, что облегчает их диагностику и исправление.
- Логи позволяют фиксировать информацию о времени отклика запросов, загрузке системы и других метриках, что помогает выявить узкие места и улучшить производительность.
- Логи помогают воспроизвести последовательность событий, которая привела к ошибке или сбою.
- С помощью логов можно анализировать прошлые события и инциденты, что помогает выявить повторяющиеся проблемы и предсказать потенциальные риски.
- Логирование помогает отслеживать попытки несанкционированного доступа, подозрительные активности и ошибки безопасности.
- Логи могут содержать информацию о производительности различных компонентов системы, таких как время отклика запросов.

# Предлагаемое решение
## Технология
Логирование будет реализовано с помощью стека ELK (ElasticSearch, Logstash, Kibana, Beats)

## Компоненты которые нужно внедрить:
- развернуть и сконфигурировать Logstash
- развернуть и сконфигурировать ElasticSearch
- развернуть и сконфигурировать Kibana
- интегрировать агенты для сбора логов (Filebeat) на инстансы сервисов.
- залогировать требуемые операции в сервисах
[jewerly_c4_model](https://drive.google.com/file/d/1EKdSMCwP17zEAiy0-y6Kd0OXGJ1yuTHm/view?usp=sharing)

## Политика безопасности:
- Необходимо закрыть доступ к портам и адресам ELK из внешний сети, доступ к ELK возможен только через Kibana.
- Kibana закрыть за сервером авторизации с доступом пользователей с ролью "Поддержка".

## Политика хранения (ILM)
``"rollover": {
    "max_primary_shard_size": "50GB",
    "max_age": "180d"
}``

# Мероприятия для превращения системы сбора логов в систему анализа логов
## Алерты
- на аномальный рост количества запросов к публичным API (вероятность DDoS)
- на аномальный рост количества ошибок уровня ERROR
- возникновение ошибок уровня уровня FATAL