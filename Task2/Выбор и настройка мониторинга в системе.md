# Мотивация
Уже сейчас компания сталкивается с ухудшением клиентского и пользовательского опыта, вызванного ростом нагрузки, снижением отзавчивости и задержками в исполнении заказов. Отсутсвие трейсинга не позволяет оперативно выявлять, локализовывать и утранять проблемы. Ситуация имеет тенденцию к усугублению. Как итог компания теряет клиентов и деньги.
Мониторинг является критически важной частью и необходим для обеспечения стабильной и эффективной работы системы, он позволяет поддерживать высокое качество и надежность программного обеспечения.

- Мониторинг позволяит быстро выявлять и устранять проблемы в работе, что минимизирует время простоя.
- С помощью мониторинга можно отслеживать производительность, время отклика и нагрузку, что поможет в оптимизации работы системы.
- С помощью мониторинга можно собирать данные о взаимодействии пользователей с сервисами, что поможет улучшить пользовательский опыт и выявить узкие места.
- Мониторинг поможет проверять, соответствуют ли система установленным соглашениям об уровне обслуживания (SLA), что важно для поддержания доверия клиентов.
- Системы мониторинга позволит настроить на автоматическое уведомление о проблемах, что позволит команде проактивно реагировать на потенциальные сбои.

# Выбор подхода к мониторингу
## Общее для каждого сервиса, БД, брокера
- health-check флаг состояния того или иного сервиса, с настроенной автоматизаций перезапуска и/или алертом.
- **Метки**: 
    - Имя сервиса `service-name`

## Для API(Shop, CRM, MES) хорошо подойдет RED
- **Requests**: количество запросов к API.
    - Number of requests (RPS) for internet shop API
    - Number of requests (RPS) for CRM API
    - Number of requests (RPS) for MES API
- **Errors**: количество ошибок при обработке запросов.
    - Number of HTTP 500 for shop API
    - Number of HTTP 500 for CRM API
    - Number of HTTP 500 for MES API
- **Duration**: время, необходимое для обработки запросов.
    - Response time (latency) for shop API
    - Response time (latency) for CRM API
    - Response time (latency) for MES API
- **Метки**: 
    - Метод `method`
    - Статус ответа `status`
    - Имя сервиса `service-name`

## Для реляционных БД хорошо подойдет USE
- **Utilization**: использование ресурсов.
    - CPU % for shop db instance
    - CPU % for MES db instance
    - Size of shop db instance
    - Size of MES db instance
- **Saturation**: уровень нагрузки на систему и ее компонентов.
    - Lock Saturation - Количество активных блокировок.
    - Query Queue Length - Длина очереди запросов, ожидающих выполнения.
- **Errors**: количество ошибок.
    - Query Errors - Количество запросов, завершившихся с ошибками.
    - Transaction Errors - Количество ошибок при выполнении транзакций.
- **Метки**:
    - Имя сервиса `service-name`

## Для хранилища S3 хорошо подойдет USE
- **Utilization**: использование ресурсов.
    - CPU % for S3 storage
    - Size of S3 storage
    - Data Transfer Utilization - Объем передаваемах данных.
- **Saturation**: уровень нагрузки на систему и ее компонентов.
    - Bucket Size Saturationю - Количество объектов в бакете по сравнению с рекомендуемым лимитом.
    - Concurrency Saturation - Количество одновременных операций.
- **Errors**: количество ошибок.
    - Throttling Errors - Количество случаев, когда запросы к S3 были ограничены из-за превышения лимитов.
    - Timeout Errors - Количество ошибок, связанных с таймаутом.

##  Для брокера сообщений хорошо подойдет USE
- **Utilization**: использование ресурсов.
    - Disk Space Utilization - Объем используемого места на диске для хранения сообщений.
- **Saturation**: уровень нагрузки на систему и ее компонентов.
    - Number of message in flight in RabbitMQ
- **Errors**: количество ошибок.
    - Number of dead-letter-exchange letters in RabbitMQ
    - Message Acknowledgment Errors - количество ошибок, связанных с подтверждением получения сообщений.
- **Метки**:
    - Имя очереди `queue-name`

# План действий
1. Развернуть и сконфигурировать Prometheus
2. Интегрировать Prometheus в сервисы для сбора метрик
3. Развернуть и настроить Grafana
4. Создать необходимые дашборды для мониторинга сервисов
5. Настроить оповещения при достижении пороговых значений метрик